Nui.define('src/paging',function(require,imports,renders,extend){!function(t,e,a,i){function n(i){var l=this;l.load=!1,l.instance=function(){for(var e in t)if(t[e]==l)return e.toString()},a.extend(l,a.extend(!0,{url:'',wrap:null,paramJSON:'',pCount:10,current:1,aCount:0,last:!1,allData:!1,isFull:!0,container:t,scroll:{enable:!1},ajax:{},condition:{},loading:{wrap:null,show:function(){var t=this;t.hide();var e=t.wrap;e&&e.append('<i class="ui-loading" style="position:absolute;">正在加载数据...</i>').css({position:'relative'})},hide:function(){a('.ui-loading').remove()}},button:{prev:'«',next:'»',first:'',last:''},extPage:{wrap:null,desc:'',prev:'上一页',next:'下一页'},refreshCallback:null,endCallback:a.noop,jumpCallback:a.noop,echoData:a.noop},n.options,i||{})),l.container=a(l.container||t),!0===l.scroll.enable&&(l.wrap=null,l.children=l.container[0]===t?a(e.body):l.container.children(),l.container.scroll(function(){l.resize()}).resize(function(){l.resize()}))}var l=function(t){return t.dataType='json',a.ajax(t)};n.options={},n.config=function(t){a.extend(!0,n.options,t||{})},n.prototype={constructor:n,jump:function(t){var e,i=this,n=Math.ceil(i.aCount/i.pCount);if(i.showload=!0,i.aCount>0)if('object'==typeof t){var l=a(t).prevAll('input').val();e=l<=n&&l!=i.current?parseInt(l):i.current}else e=t>0&&t<=n?t:t<0?n+t+1:n;else e=t;if(i.current=i.condition.current=e,i.jumpCallback(e),'function'==typeof i.refreshCallback)return i.refreshCallback(e),void i.create();i.getData('jump')},query:function(t){var e=this;e.showload=!0,e.load=!1,'function'!=typeof e.refreshCallback||'refresh'!==t?(t?('noloading'===t?e.showload=!1:'reload'!==t&&(e.current=1),e.filter(),e.condition.current=e.current):e.condition={current:e.current=1},e.getData(t||'')):e.create()},filter:function(){var t=this;for(var e in t.condition)t.condition[e]||delete t.condition[e]},getData:function(e){var i=this;i.condition.pCount=i.pCount,!0===i.allData&&(delete i.condition.pCount,delete i.condition.current);var n=i.condition;if(i.paramJSON){n=[],a.each(i.condition,function(t,e){n.push(t+':'+e)});var r=n.length?'{'+n.join(',')+'}':'';n={},n[i.paramJSON]=r}var o='function'==typeof i.ajax?i.ajax():i.ajax;delete o.success,i.load||(i.load=!0,l(a.extend({},!0,{url:i.url,data:n,success:function(a){try{a.current=i.current}catch(t){}var n,l=0;if(i.container[0]===t||'reload'===e||'noloading'===e||'jump'===e&&('jump'!==e||i.scroll.enable)||(i.container.scrollTop(0),i.container.scrollLeft(0)),'reload'===e){var r=i.container;i.selector?(r=i.container.find(i.selector),l=r.scrollTop()):l=r.scrollTop(),n=r.find('tr.rows.s-crt').index()}if(i.echoData(a,e),i.aCount=a.aCount,i.load=!1,!0===i.scroll.enable&&i.resize(),l>0){var r=i.container;i.selector?(r=i.container.find(i.selector),r.scrollTop(l)):r.scrollTop(l),n>=0&&r.find('tr.rows').eq(n).addClass('s-crt')}if(!0===i.last)return i.last=!1,void i.jump(-1);i.create(),i.endCallback(a)},error:function(){i.showload&&i.loading.hide(),i.load=!1}},o||{})))},trim:function(t){var e=Math.abs(parseInt(a(t).val()));!e&&(e=1),a(t).val(e)},echoList:function(t,e,a){return this.current==e?'<li><span class="s-crt">'+e+'</span></li>':'<li><a href="javascript:'+a+'.jump('+e+');" target="_self">'+e+'</a></li>'},resize:function(){var t=this;try{var e=t.container.scrollTop(),a=t.container.height(),i=t.children.outerHeight();!t.load&&Math.ceil(t.aCount/t.pCount)>t.current&&(0===e&&i<=a||a+e>=i)&&t.jump(++t.current)}catch(t){}},create:function(){var t=this,e=t.button,a=Math.ceil(t.aCount/t.pCount),i=t.current,n='',l=a==i?1:i+1,r=t.instance(),o=t.extPage;if(o.wrap){var c='<div>';c+=i==a||0==a?'<span>'+o.next+'</span>':'<a href="javascript:'+r+'.jump('+(i+1)+');" target="_self">'+o.next+'</a>',c+=1==i?'<span>'+o.prev+'</span>':'<a href="javascript:'+r+'.jump('+(i-1)+');" target="_self">'+o.prev+'</a>',c+='</div><em>'+(0!==a?i:0)+'/'+a+'</em><strong>共'+t.aCount+o.desc+'</strong>',o.wrap.html(c)}if(t.wrap){if(!a)return void t.wrap.empty();if(n+=function(){var a='';return 1==i?(e.first&&(a+='<li><span>'+e.first+'</span></li>'),a+='<li><span>'+e.prev+'</span></li>'):(t.button.first&&(a+='<li><a href="javascript:'+r+'.jump(1);" target="_self">'+e.first+'</a></li>'),a+='<li><a href="javascript:'+r+'.jump('+(i-1)+');" target="_self">'+e.prev+'</a></li>'),a}(),a<=7)for(var s=1;s<=a;s++)n+=t.echoList(n,s,r);else if(i-3>1&&i+3<a){n+='<li><a href="javascript:'+r+'.jump(1);" target="_self">1</a></li>',n+='<li><em>...</em></li>';for(var s=i-2;s<=i+2;s++)n+=t.echoList(n,s,r);n+='<li><em>...</em></li>',n+='<li><a href="javascript:'+r+'.jump('+a+');" target="_self">'+a+'</a></li>'}else if(i-3<=1&&i+3<a){for(var s=1;s<=5;s++)n+=t.echoList(n,s,r);n+='<li><em>...</em></li>',n+='<li><a href="javascript:'+r+'.jump('+a+');" target="_self">'+a+'</a></li>'}else if(i-3>1&&i+3>=a){n+='<li><a href="javascript:'+r+'.jump(1);" target="_self">1</a></li>',n+='<li><em>...</em></li>';for(var s=a-5;s<=a;s++)n+=t.echoList(n,s,r)}n+=function(){var t='';return i==a?(t+='<li><span>'+e.next+'</span></li>',e.last&&(t+='<li><span>'+e.last+'</span></li>')):(t+='<li><a href="javascript:'+r+'.jump('+(i+1)+');" target="_self">'+e.next+'</a></li>',e.last&&(t+='<li><a href="javascript:'+r+'.jump('+a+');" target="_self">'+e.last+'</a></li>')),t}(),t.isFull&&(n+='<li><em>跳转到第</em><input type="text" onblur="'+r+'.trim(this);" value="'+l+'" /><em>页</em><button type="button" onclick="'+r+'.jump(this);">确定</button></li>'),n='<ul class="ui-paging">'+n+'</ul>',t.wrap.html(n)}}},a.extend({paging:function(e,a){void 0===a&&(a=e,e='paging');var i=t[e]=new n(a);return'function'!=typeof t[e].refreshCallback?(i.query(!0),i):(i.query('refresh'),i)}}),t.Paging=n}(window,document,jQuery)}),Nui.define('src/components/datagrid',['component'],function(t){var e=this;e.require('src/paging');return e.extend(t,{static:{_init:function(){var t=this;Nui.doc.on('click',function(){Nui.each(t.__instances,function(t){!0===t.options.isActive&&t.element.find('.datagrid-tbody table-row.s-crt').removeClass('s-crt')})})},_hasChildren:function(t){return Nui.isArray(t.children)&&t.children.length},_getRowNumber:function(t,e,a,i,n){var l=this;return a[e]||(a[e]=!0),void 0===i&&(i=0),Nui.each(t,function(t){t.cellid=i++,n&&n.fixed&&(t.fixed=n.fixed),l._hasChildren(t)&&(i=l._getRowNumber(t.children,e+1,a,i,t))}),n?i:a.length},_colspan:function(t,e){var a=this;return void 0===e&&(e=0),Nui.each(t,function(t){a._hasChildren(t)?e+=a._colspan(t.children,e):e+=1}),e}},options:{data:null,columns:null,isFixed:!0,isLine:!1,isActive:!0,isBorder:!0,url:null,paging:null,fields:null,dataName:'list',width:'100%',height:'auto',footer:'',onFocusin:null,onFocusout:null,onFocus:null,onBlur:null,stringify:null,onRowClick:null,onRowDblclick:null,onCheckboxChange:null,onRenderBefore:null,onRender:null},_template:{layout:'<div class="<% className %>"><div class="datagrid-body"><%include "table"%></div><div class="datagrid-foot"><%if footer%><%footer%><%/if%><%if paging%><div class="datagrid-paging"></div><%/if%></div></div>',table:'<%each rows v k%><%if v.length%><div class="datagrid-table<%if k === "left" || k === "right"%> datagrid-table-fixed<%/if%> datagrid-table-<%k%>"><div class="datagrid-title"><div class="datagrid-thead"><table class="ui-table"><thead class="table-thead"><%each v%><tr class="table-row"><%each $value val%><th class="table-cell"<%include "attr"%>><span class="cell-text"><%if val.content === "checkbox"%><span class="ui-checkradio"><input type="checkbox" name="datagrid-checkbox"></span><%else%><%val.title%><%/if%></span></th><%/each%></tr><%/each%></thead><%if isFixed !== true%><tbody class="table-tbody datagrid-inner"></tbody><%/if%></table></div></div><%if isFixed === true%><div class="datagrid-inner"></div><%/if%></div><%/if%><%/each%>',tbody:'<%if isFixed === true%><div class="datagrid-tbody"><table class="ui-table"><tbody class="table-tbody"><%include "rows"%></tbody></table></div><%else%><%include "rows"%><%/if%>',rows:'<%if list && list.length%><%var toLower = function(str){return str.replace(/([A-Z])/g, function(a){return "-"+a.toLowerCase()})}%><%each list%><tr class="table-row" data-row-index="<%$index%>"<%include "data"%>><%each cols val key%><%var _value%><%if val.field && (!val.content || "number checkbox input".indexOf(val.content)===-1)%><%var _value=$value[val.field]%><%elseif val.content === "number"%><%var _value=$index+1%><%elseif val.content === "checkbox"%><%var _value={"name":val.field ? val.field : "datagrid-checkbox", "value":$value[val.field]!==undefined?$value[val.field]:""}%><%elseif val.content === "input"%><%var _value={"name":val.field ? val.field : "datagrid-input", "class":"datagrid-input", "value":$value[val.field]!==undefined?$value[val.field]:""}%><%else%><%var _value=val.content%><%/if%><td class="table-cell"<%include "attr"%>><span class="cell-text<%if val.nowrap === true%> cell-nowrap<%/if%>"><%if typeof val.filter === "function"%><%var _value = val.filter(_value, val.field, $value)%><%/if%><%if val.content === "checkbox" && typeof _value === "object"%><span class="checkradio"><input type="checkbox"<%include "_attr"%>></span><%elseif val.content === "input" && typeof _value === "object"%><input type="text" autocomplete="off"<%include "_attr"%>><%else%><%_value%><%/if%></span></td><%/each%></tr><%/each%><%else%><tr><td class="table-cell"></td></tr><%/if%>',head:'',foot:'',_attr:'<%each _value _v _k%> <%_k%>="<%_v%>"<%/each%>',attr:'<%each val value name%><%if "width field align valign colspan rowspan cellid".indexOf(name) !== -1%> <%name%>="<%value%>"<%/if%><%/each%>',data:'<%if fields%><%each $value value field%><%if fields === true || $.inArray(field, fields) !== -1%> data-<%toLower(field)%>=<%if typeof stringify === "function"%><%stringify(value)%><%else%>"<%value%>"<%/if%><%/if%><%/each%><%/if%>'},_init:function(){this._exec()},_exec:function(){var t=this,e=t.options;t._getTarget()&&Nui.isArray(e.columns)&&e.columns.length&&(t._columns={left:[],normal:[],right:[]},Nui.each(e.columns,function(e,a){'left'===e.fixed||!0===e.fixed?t._columns.left.push(e):'right'===e.fixed&&t._columns.right.push(e),t._columns.normal.push(e)}),t._create())},_create:function(){var t=this,e=t.options,a=t.constructor;t._rows={},t._cols={},t._rowNumber=a._getRowNumber(e.columns,0,[]),Nui.each(t._columns,function(e,a){t._setRowCol(e,a)}),t._hasLeftRight=this._cols.left.length||this._cols.right.length,t.element=$(t._tpl2html('layout',t._tplData({rows:t._rows,isFixed:e.isFixed,paging:'object'==typeof e.paging,footer:e.footer}))).appendTo(t.target),t._body=t.element.children('.datagrid-body'),t._tableNormal=t._body.children('.datagrid-table-normal'),t._tableNormalInner=t._tableNormal.children('.datagrid-inner'),t._tableNormalTitle=t._tableNormal.children('.datagrid-title'),t._tableNormalThead=t._tableNormalTitle.children('.datagrid-title'),t._tableLeft=t._body.children('.datagrid-table-left'),t._tableRight=t._body.children('.datagrid-table-right'),t._tableFixed=t._body.children('.datagrid-table-fixed'),t._tableFixedInner=t._tableFixed.children('.datagrid-inner'),t._foot=t.element.children('.datagrid-foot'),t._theadHeight(),t._initList(),t._bindEvent()},_initList:function(){var t=this,e=t.options;if(e.paging){e.paging.wrap=t._foot.children('.datagrid-paging');var a='paging_'+t.__id,i=e.paging.echoData;e.paging.echoData=function(a,n){t._list=a[e.dataName]||[],t._render(),'function'==typeof i&&i.call(e.paging,a,n)},t.paging=$.paging(a,e.paging)}else e.data&&(t._list=e.data,t._render())},_bindEvent:function(){var t=this;t._on('scroll',t._tableNormalInner,function(){t._scroll($(this))}),t._event()},_render:function(){var t=this,e=t.options;Nui.each(t._cols,function(a,i){t.element.find('.datagrid-table-'+i+' > .datagrid-inner').html(t._tpl2html('tbody',{isFixed:e.isFixed,cols:a,fields:e.fields?!0===e.fields?e.fields:[].concat(e.fields):null,list:t._list,stringify:e.stringify}))}),t._rowHeight(),t._resetHeight()},_resetHeight:function(){var t=this,e=t.options;if(!0===e.isFixed){var a=t.target.innerHeight(),i=t._tableNormalInner.children('.datagrid-tbody'),n=a-t._tableNormalTitle.outerHeight()-t._foot.outerHeight();t._tableNormal.find('.datagrid-thead > .ui-table').width(e.width),t._tableNormal.find('.datagrid-tbody > .ui-table').width(e.width),i.children().width()>t._tableNormalInner.width()?t._tableFixedInner.height(n-17):t._tableFixedInner.height(n),t._tableNormalInner.height(n);var l=t._tableNormalInner.innerWidth()-t._tableNormalInner.children().width();t._tableNormalTitle.css({'margin-right':l}),t._tableRight.css('right',l)}},_theadHeight:function(){var t=this;t._hasLeftRight&&t._tableFixed.find('.table-thead .table-cell').each(function(e){var a=$(this),i=a.attr('cellid'),n=t._tableNormalThead.find('.table-cell[cellid="'+i+'"]'),l=n.innerHeight();Nui.browser.msie&&(Nui.browser.version>8?l+=1:7==Nui.browser.version&&(l-=1)),a.height(l)})},_rowHeight:function(){var t=this;if(t._hasLeftRight){var e=t._tableLeft.find('.table-tbody .table-row'),a=t._tableLeft.find('.table-tbody .table-row');t._tableNormal.find('.table-tbody .table-row').each(function(t){var i=$(this).outerHeight();e.eq(t).height(i),a.eq(t).height(i)})}},_setRowCol:function(t,e,a){var i=this,n=(i.options,i.constructor);void 0===a&&(a=0),i._rows[e]||(i._rows[e]=[]),i._cols[e]||(i._cols[e]=[]),t.length&&!i._rows[e][a]&&(i._rows[e][a]=[]),Nui.each(t,function(t){var l=n._hasChildren(t),r={};l&&(r.colspan=n._colspan(t.children),i._setRowCol(t.children,e,a+1)),Nui.each(t,function(t,e){'children'!==e&&'function'!=typeof t&&(r[e]=t)}),l||(r.rowspan=i._rowNumber-a,i._cols[e].push(t)),i._rows[e][a].push(r)})},_callback:function(){var t=arguments,e=t[0],a=this.options['on'+e];if('function'==typeof a)return a.apply(this,Array.prototype.slice.call(t,1))},_events:{'click .table-tbody .table-row':'_active _getRowData _rowclick','dblclick .table-tbody .table-row':'_getRowData _rowdblclick','focus .datagrid-input':'_enable _getRowData _focus','blur .datagrid-input':'_enable _getRowData _blur','focusin .table-tbody .table-cell':'_focusin','focusout .table-tbody .table-cell':'_focusout'},_enable:function(t,e){return!e.hasClass('s-dis')&&!e.hasClass('s-disabled')},_active:function(t,e){var a=this;!0===a.options.isActive&&(a.element.find('.datagrid-tbody .table-row').eq(e.index()).addClass('s-crt').siblings().removeClass('s-crt'),Nui.each(a.__instances,function(t){t!==a&&!0===t.options.isActive&&t.element.find('.datagrid-tbody table-row.s-crt').removeClass('s-crt')}),t.stopPropagation())},_getRowData:function(t,e){return e.hasClass('table-row')?e.data():e.closest('.table-row').data()},_focusin:function(t,e,a){return this._callback('Focusin',t,e,a)},_focusout:function(t,e,a){return this._callback('Focusout',t,e,a)},_rowclick:function(t,e,a){return this._callback('RowClick',t,e,a)},_rowdblclick:function(t,e,a){return this._callback('RowDblclick',t,e,a)},_scroll:function(t){var e=this,a=t.scrollTop(),i=t.scrollLeft();e._tableFixedInner.scrollTop(a),e._tableNormalThead.scrollLeft(i)}})}),Nui.define('./script/demo',function(require,imports,renders,extend){require('src/components/datagrid')({target:'#data',width:'110%',paging:{url:'http://127.0.0.1/data/'},footer:'11',data:[{id:'11111111',prov:'安徽',city:'蚌埠',address:'安徽蚌',job:'php工程师',name:'阿牛'},{id:'22222222',prov:'浙江',city:'杭州',address:'浙江杭州',job:'前端工程师',name:'尹加增'},{id:'22222222',prov:'浙江',city:'杭州',address:'浙江杭州',job:'前端工程师',name:'尹加增'},{id:'22222222',prov:'浙江',city:'杭州',address:'浙江杭州',job:'前端工程师',name:'尹加增'},{id:'22222222',prov:'浙江',city:'杭州',address:'浙江杭州',job:'前端工程师',name:'尹加增'},{id:'22222222',prov:'浙江',city:'杭州',address:'浙江杭州',job:'前端工程师',name:'尹加增'},{id:'22222222',prov:'浙江',city:'杭州',address:'浙江杭州',vC:{a:1},a:[{a:1}],job:'前端工程师',name:'尹加增'},{id:'22222222',prov:'浙江',city:'杭州',address:'浙江杭州',job:'前端工程师',name:'尹加增'},{id:'22222222',prov:'浙江',city:'杭州',address:'浙江杭州',job:'前端工程师',name:'尹加增'},{id:'22222222',prov:'浙江',city:'杭州',address:'浙江杭州',job:'前端工程师',name:'尹加增'},{id:'22222222',prov:'浙江',city:'杭州',address:'浙江杭州',job:'前端工程师',name:'尹加增'}],columns:[{title:'编号',content:'number',width:'40',fixed:!0},{title:'ID',field:'id',width:'200'},{title:'期初余额',field:'address',width:'400',children:[{title:'借方',width:'200',field:'buaddress',nowrap:!0,filter:function(t,e,a){return''}},{title:'借方',width:'200',field:'buaddress',nowrap:!0}]},{title:'姓名',field:'certificate',content:'input',width:200},{title:'职业',field:'buname'},{title:'操作',content:'<a class="datagrid-button" on-click="alter">修改</a> <a class="datagrid-button" on-click="delete">删除</a>',width:150,fixed:'right'}],onRowClick:function(t,e,a){},onRowDblclick:function(t,e,a){}})});
//# sourceMappingURL=demo-min.js.map?v=32e1e24