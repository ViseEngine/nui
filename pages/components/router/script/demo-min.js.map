{"version":3,"sources":["demo-debug.js"],"names":["Nui","define","component","template","events","statics","_paths","_init","self","this","doc","on","back","forward","_setpaths","rule","paths","_replace","hash","replace","location","protocol","host","_getWrapper","container","$","appendTo","_split","url","ret","params","match","split","each","v","k","arr","_change","isEmptyObject","_hash","query","path","indexOf","object","__instances","id","opts","options","param","length","isRender","_isRrender","_wrapper","data","extend","_defaultOptions","val","key","_send","onData","call","onChange","wrapper","destroy","off","element","tmpl","html","render","main","onInit","init","show","siblings","hide","onAfter","_initialize","bsie7","_setHistory","_isEntry","entry","target","_render","eq","_oldhash","_bindHashchange","hashchange","setInterval","win","_$ready","_$fn","start","arguments","temp","_router","index","history","_history","_isHistory","active","push","value","len","i","window","static","level","onBefore","router","constructor","_exec","_bind","_jquery","_getpath","sub","shift","join","_getTarget","_event","__id","substr","href","jQuery","attr","trigger","change","_on","e","elem","_reset","_off","option","reset","list","detail","title","tpl"],"mappings":"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","file":"demo-min.js.map?v=ec9800c","sourcesContent":["/**\r\n * @author Aniu[2017-02-27 23:46]\r\n * @update Aniu[2017-02-27 23:46]\r\n * @version 1.0.1\r\n * @description 路由\r\n */\r\n\r\nNui.define('src/components/router',['component', 'template', 'events'], function(component, template, events){\r\n    var statics = {\r\n        _paths:{},\r\n        _init:function(){\r\n            var self = this;\r\n            Nui.doc.on('click', '.nui-router-back', function(){\r\n                return self.back()\r\n            }).on('click', '.nui-router-forward', function(){\r\n                return self.forward()\r\n            })\r\n        },\r\n        _setpaths:function(rule, paths){\r\n            if(!this._paths[rule]){\r\n                this._paths[rule] = paths\r\n            }\r\n        },\r\n        _replace:function(hash){\r\n                        //IE8-中 A标签href属性会被添加上域名，将其移除\r\n            return hash.replace(location.protocol+'//'+location.host, '')\r\n                        //移除空白\r\n                       .replace(/\\s+/g, '')\r\n                       //移除 #!前缀\r\n                       .replace(/^\\#\\!?/, '')\r\n                       //开头添加斜杠\r\n                       .replace(/^([^\\/])/, '/$1')\r\n                       //移除末尾斜杠\r\n                       .replace(/\\/$/, '');\r\n        },\r\n        _getWrapper:function(container){\r\n            return $('<div class=\"nui-router-wrapper\"></div>').appendTo(container)\r\n        },\r\n        _split:function(url){\r\n            var ret = {\r\n                url:url,\r\n                params:{}\r\n            }\r\n            var match = url.match(/\\?[^\\/\\s]+/);\r\n            if(match){\r\n                var params = match[0];\r\n                ret.url = url.replace(params, '');\r\n                params = params.replace('?', '').split('&');\r\n                Nui.each(params, function(v, k){\r\n                    var arr = v.split('=');\r\n                    ret.params[arr[0]] = arr[1]\r\n                })\r\n            }\r\n            return ret;\r\n        },\r\n        _change:function(){\r\n            var self = this;\r\n            if(!$.isEmptyObject(self._paths)){\r\n                var _hash = location.hash, ret = this._split(_hash), hash = self._replace(ret.url), query = ret.params;\r\n                Nui.each(self._paths, function(v){\r\n                    if(hash === v.path || hash.indexOf(v.path) === 0){\r\n                        var params = hash.replace(v.path, '').replace(/^\\//, '');\r\n                        var object = self.__instances[v.id], opts = object.options, param = {};\r\n                        params = params ? params.split('/') : [];\r\n                        if(params.length === v.params.length){\r\n                            var isRender = object._isRrender === true;\r\n\r\n                            if(!object._wrapper || (object._wrapper && isRender)){\r\n                                opts.data = $.extend(true, {}, object._defaultOptions.data);\r\n                            }\r\n\r\n                            Nui.each(v.params, function(val, key){\r\n                                param[val] = params[key]\r\n                            })\r\n\r\n                            Nui.each(query, function(val, key){\r\n                                param[val] = query[key]\r\n                            })\r\n\r\n                            if(object._send && object._send.data && typeof opts.onData === 'function'){\r\n                                opts.onData.call(opts, object._send.data);\r\n                                delete object._send;\r\n                            }\r\n\r\n                            opts.data.path = v.path+'/';\r\n                            opts.data.url = hash+'/';\r\n                            opts.data.params = param;\r\n                            opts.data.query = query;\r\n\r\n                            if(typeof opts.onChange === 'function'){\r\n                                opts.onChange.call(opts);\r\n                            }\r\n\r\n                            if(isRender || !object._wrapper){\r\n                                if(opts.wrapper && !object._wrapper){\r\n                                    object._wrapper = self._getWrapper(object.container)\r\n                                }\r\n                                else if(!self._wrapper){\r\n                                    self._wrapper = self._getWrapper(object.container)\r\n                                }\r\n                                if(object._isRrender || !object._wrapper){\r\n                                    component.destroy((object._wrapper||self._wrapper).off());\r\n                                }\r\n                                var wrapper = opts.element = object._wrapper || self._wrapper;\r\n                                var tmpl = opts.template;\r\n                                \r\n                                if(tmpl){\r\n                                    if(typeof tmpl === 'string'){\r\n                                        wrapper.html(template.render(tmpl, opts.data));\r\n                                    }\r\n                                    else{\r\n                                        wrapper.html(template.render.call(tmpl, tmpl.main, opts.data));\r\n                                    }\r\n                                }\r\n                                if(typeof opts.onInit === 'function'){\r\n                                    opts.onInit.call(opts);\r\n                                }\r\n                                events.call(opts);\r\n                                component.init(wrapper);\r\n                                delete object._isRrender;\r\n                            }\r\n                            var wrapper = object._wrapper || self._wrapper;\r\n                            wrapper.show().siblings('.nui-router-wrapper').hide();\r\n                            if(typeof opts.onAfter === 'function'){\r\n                                opts.onAfter.call(opts)\r\n                            }\r\n                            self._initialize = match = true;\r\n                            if(Nui.bsie7){\r\n                                self._setHistory(_hash);\r\n                            }\r\n                            return false\r\n                        }\r\n                    }\r\n                })\r\n\r\n                if(!self._initialize){\r\n                    Nui.each(self.__instances, function(v){\r\n                        if(!self._isEntry && v.options.entry === true){\r\n                            self._isEntry= true;\r\n                            if(v.target){\r\n                                v._render(v.target.eq(0));\r\n                            }\r\n                            self._initialize = true;\r\n                            return false\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n            self._oldhash = _hash;\r\n        },\r\n        _bindHashchange:function(){\r\n            var self = this;\r\n            if(Nui.bsie7){\r\n                var hashchange = function(ret){\r\n                    var hash = location.hash;\r\n                    if(self._oldhash !== hash){\r\n                        return !ret\r\n                    }\r\n                    return false\r\n                }\r\n                setInterval(function(){\r\n                    if(hashchange()){\r\n                        self._change()\r\n                    }\r\n                }, 100);\r\n                hashchange(true)\r\n            }\r\n            else{\r\n                Nui.win.on('hashchange', function(){\r\n                    self._change()\r\n                })\r\n            }\r\n        },\r\n        _$ready:null,\r\n        _$fn:null,\r\n        init:null,\r\n        start:function(){\r\n            if(!this._initialize){\r\n                this._change();\r\n            }\r\n        },\r\n        location:function(url, data, render){\r\n            var self = this;\r\n            if(url){\r\n                if(arguments.length <=2 && typeof data === 'boolean'){\r\n                    render = data;\r\n                    data = null;\r\n                }\r\n                var temp, _router;\r\n                url = this._replace(url);\r\n                Nui.each(this._paths, function(val, rule){\r\n                    if(rule === url || (url.indexOf(val.path) === 0 &&\r\n                                        (temp = url.replace(val.path+'/', '')) && \r\n                                        temp.split('/').length === val.params.length)){\r\n                        _router = self.__instances[val.id];\r\n                        return false\r\n                    }\r\n                })\r\n                if(_router){\r\n                    _router._send = {\r\n                        data:data\r\n                    }\r\n                    _router._isRrender = render;\r\n                    _router._render(url)\r\n                }\r\n            }\r\n            else{\r\n                self.start()\r\n            }\r\n        },\r\n        forward:function(index){\r\n            history.forward(index);\r\n            return false\r\n        },\r\n        back:function(index){\r\n            history.back(index);\r\n            return false\r\n        }\r\n    }\r\n\r\n    if(Nui.bsie7){\r\n        statics._history = [];\r\n        statics._setHistory = function(hash){\r\n            if(!this._isHistory){\r\n                Nui.each(this._history, function(val){\r\n                    val.active = false\r\n                });\r\n                this._history.push({\r\n                    hash:hash,\r\n                    active:true\r\n                })\r\n            }\r\n            this._isHistory = false;\r\n        },\r\n        Nui.each(['forward', 'back'], function(v){\r\n            var value = v==='forward' ? 1 : -1;\r\n            statics[v] = function(){\r\n                var self = this, len = self._history.length;\r\n                statics._isHistory = true;\r\n                Nui.each(self._history, function(val, i){\r\n                    var index = i + value;\r\n                    if(val.active){\r\n                        //历史记录在起始或者末尾时，调用原生的记录\r\n                        if(index === -1 || index === len){\r\n                            window.history[v]();\r\n                            return false\r\n                        }\r\n                        var _history = self._history[index];\r\n                        if(_history){\r\n                            location.hash = _history.hash;\r\n                            _history.active = true;\r\n                        }\r\n                        val.active = false;\r\n                        return false\r\n                    }\r\n                })\r\n                return false\r\n            }\r\n        })\r\n    }\r\n\r\n    return this.extend(component, {\r\n        static:statics,\r\n        options:{\r\n            path:'',\r\n            template:'',\r\n            container:null,\r\n            data:{},\r\n            entry:false,\r\n            wrapper:false,\r\n            level:1,\r\n            onBefore:null,\r\n            onChange:null,\r\n            onData:null,\r\n            onInit:null,\r\n            onAfter:null\r\n        },\r\n        _init:function(){\r\n            var self = this, router = self.constructor;\r\n            if(self._exec() && !router._bind){\r\n                router._bind = true;\r\n                router._bindHashchange();\r\n            }\r\n        },\r\n        _exec:function(){\r\n            var self = this, opts = self.options, router = self.constructor;\r\n            self.container = router._jquery(opts.container);\r\n            if(opts.path && self.container){\r\n                self.path = router._replace(opts.path);\r\n                var paths = self._getpath();\r\n                var len = paths.params.length;\r\n                if((!len && opts.level === 1) || opts.level !== 1){\r\n                    router._setpaths(paths.rule, paths)\r\n                }\r\n                if(len && opts.level > 0){\r\n                    var params = [], split = '/:', param, sub;\r\n                    while(param = paths.params.shift()){\r\n                        params.push(param);\r\n                        sub = params.join(split);\r\n                        router._setpaths(paths.rule+split+sub, $.extend({}, paths, {\r\n                            params:sub.split(split)\r\n                        }))\r\n                    }\r\n                }\r\n                if(self._getTarget()){\r\n                    return self._event()\r\n                }\r\n            }\r\n        },\r\n        _getpath:function(){\r\n            var self = this, path = self.path, opts = self.options, index = path.indexOf('/:');\r\n            var paths = {\r\n                id:self.__id,\r\n                params:[],\r\n                rule:path,\r\n                path:path\r\n            }\r\n            if(index !== -1){\r\n                paths.params = path.substr(index+2).split('/:');\r\n                paths.path = path.substr(0, index);\r\n                if(opts.level > 0){\r\n                    paths.rule = paths.path;\r\n                }\r\n            }\r\n            return paths\r\n        },\r\n        _render:function(url){\r\n            var self = this, opts = self.options, href = url instanceof jQuery ? url.attr('href') : url;\r\n            if(href){\r\n                var trigger = false;\r\n                var change = function(){\r\n                    trigger = true;\r\n                    location.hash = '#!'+self.constructor._replace(href)\r\n                }\r\n                if(typeof opts.onBefore === 'function' && opts.onBefore.call(opts, change) === false){\r\n                    return false\r\n                }\r\n                if(!trigger){\r\n                    change()\r\n                }\r\n            }\r\n        },\r\n        _event:function(){\r\n            var self = this, opts = self.options;\r\n            self._on('click', Nui.doc, self.target, function(e, elem){\r\n                self._render(elem);\r\n                return false\r\n            })\r\n            return self\r\n        },\r\n        _reset:function(){\r\n            var self = this, router = self.constructor;\r\n            self._off();\r\n            Nui.each(router._paths, function(val, i){\r\n                if(val.id === self.__id){\r\n                    delete router._paths[i];\r\n                }\r\n            })\r\n            return self\r\n        },\r\n        option:null,\r\n        reset:null\r\n    })\r\n})\nNui.define('./script/demo',['src/components/router'], function(router){\r\n    \r\n\trouter({\r\n\t\ttarget:'#home',\r\n\t\tentry:true,\r\n\t\tpath:'/home/',\r\n\t\tcontainer:'#main',\r\n\t\ttemplate:'<p>这是首页</p>',\r\n\t})\r\n\r\n\trouter({\r\n\t\ttarget:'#news, .news',\r\n\t\tentry:true,\r\n\t\tpath:'/news/:id/:title',\r\n\t\tcontainer:'#main',\r\n\t\tlevel:2,\r\n\t\ttemplate:{\r\n\t\t\tlist:'<ul>'+\r\n\t\t\t\t\t'<%each list%>'+\r\n\t\t\t\t\t'<li><a href=\"<%$value.url%>/<%$value.title%>\" class=\"news\"><%$value.title%></a></li>'+\r\n\t\t\t\t\t'<%/each%>'+\r\n\t\t\t\t'</ul>',\r\n\t\t\tdetail:'<div>'+\r\n\t\t\t\t\t\t'<h3><%params.title%></h3>'+\r\n\t\t\t\t\t\t'<p>这是<%params.title%>详情，id是<%params.id%>。</p>'+\r\n\t\t\t\t\t'</div>'\r\n\t\t},\r\n\t\tdata:{\r\n\t\t\tlist:[{\r\n\t\t\t\turl:'/news/1',\r\n\t\t\t\ttitle:'资讯1'\r\n\t\t\t},{\r\n\t\t\t\turl:'/news/2',\r\n\t\t\t\ttitle:'资讯2'\r\n\t\t\t}, {\r\n\t\t\t\turl:'/news/3',\r\n\t\t\t\ttitle:'资讯3'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tonChange:function(){\r\n\t\t\tvar tpl = this.template, params = this.data.params;\r\n\t\t\tif(params.id && params.title){\r\n\t\t\t\ttpl.main = tpl.detail;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\ttpl.main = tpl.list;\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\trouter.start()\r\n})\n"]}