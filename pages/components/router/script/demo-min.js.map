{"version":3,"sources":["demo-debug.js"],"names":["Nui","define","component","template","events","statics","_paths","_init","self","this","doc","on","back","forward","_setpaths","rule","paths","_replace","hash","replace","location","protocol","host","_getWrapper","container","$","appendTo","_split","url","ret","params","match","split","each","v","k","arr","_change","isEmptyObject","_hash","query","path","indexOf","object","__instances","id","opts","_options","param","length","isRender","_isRrender","unWrapper","_wrapper","loaded","data","extend","_defaultOptions","val","key","_send","onData","call","wrapper","children","destroy","off","element","onChange","tmpl","html","render","main","onInit","init","show","siblings","hide","onAfter","_initialize","bsie7","_setHistory","_isEntry","entry","target","_render","eq","_oldhash","_bindHashchange","hashchange","setInterval","win","_$ready","_$fn","start","arguments","temp","_router","index","history","_history","_isHistory","active","push","value","len","i","window","_static","level","onBefore","router","constructor","_exec","_bind","_jquery","_getpath","sub","shift","join","_getTarget","_event","__id","substr","href","jQuery","attr","trigger","change","_on","e","elem","preventDefault","_reset","_off","option","reset","renders","require","list","detail","title","tpl"],"mappings":"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","file":"demo-min.js.map?v=e9ed22c","sourcesContent":["/**\r\n * @author Aniu[2017-02-27 23:46]\r\n * @update Aniu[2017-02-27 23:46]\r\n * @version 1.0.1\r\n * @description 路由\r\n */\r\n\r\nNui.define('src/components/router',['component', 'template', 'events'], function(component, template, events){\r\n    var statics = {\r\n        _paths:{},\r\n        _init:function(){\r\n            var self = this;\r\n            Nui.doc.on('click', '.nui-router-back', function(){\r\n                return self.back()\r\n            }).on('click', '.nui-router-forward', function(){\r\n                return self.forward()\r\n            })\r\n        },\r\n        _setpaths:function(rule, paths){\r\n            if(!this._paths[rule]){\r\n                this._paths[rule] = paths\r\n            }\r\n        },\r\n        _replace:function(hash){\r\n                        //IE8-中 A标签href属性会被添加上域名，将其移除\r\n            return hash.replace(location.protocol+'//'+location.host, '')\r\n                        //移除空白\r\n                       .replace(/\\s+/g, '')\r\n                       //移除 #!前缀\r\n                       .replace(/^\\#\\!?/, '')\r\n                       //开头添加斜杠\r\n                       .replace(/^([^\\/])/, '/$1')\r\n                       //移除末尾斜杠\r\n                       .replace(/\\/$/, '');\r\n        },\r\n        _getWrapper:function(container){\r\n            return $('<div class=\"nui-router-wrapper\"></div>').appendTo(container)\r\n        },\r\n        _split:function(url){\r\n            var ret = {\r\n                url:url,\r\n                params:{}\r\n            }\r\n            var match = url.match(/\\?[^\\/\\s]+/);\r\n            if(match){\r\n                var params = match[0];\r\n                ret.url = url.replace(params, '');\r\n                params = params.replace('?', '').split('&');\r\n                Nui.each(params, function(v, k){\r\n                    var arr = v.split('=');\r\n                    ret.params[arr[0]] = arr[1]\r\n                })\r\n            }\r\n            return ret;\r\n        },\r\n        _change:function(){\r\n            var self = this;\r\n            if(!$.isEmptyObject(self._paths)){\r\n                var _hash = location.hash, ret = this._split(_hash), hash = self._replace(ret.url), query = ret.params;\r\n                Nui.each(self._paths, function(v){\r\n                    if(hash === v.path || hash.indexOf(v.path) === 0){\r\n                        var params = hash.replace(v.path, '').replace(/^\\//, '');\r\n                        var object = self.__instances[v.id], opts = object._options, param = {};\r\n                        params = params ? params.split('/') : [];\r\n                        if(params.length === v.params.length){\r\n                            var isRender = object._isRrender === true;\r\n                            var unWrapper = object._isRrender !== false && !object._wrapper;\r\n                            var _isRrender = !object.loaded || isRender || unWrapper;\r\n                            delete object._isRrender;\r\n\r\n                            if(unWrapper || (object._wrapper && isRender)){\r\n                                opts.data = $.extend(true, {}, object._defaultOptions.data);\r\n                            }\r\n\r\n                            Nui.each(v.params, function(val, key){\r\n                                param[val] = params[key]\r\n                            })\r\n\r\n                            Nui.each(query, function(val, key){\r\n                                param[val] = query[key]\r\n                            })\r\n\r\n                            opts.data.path = v.path+'/';\r\n                            opts.data.url = hash+'/';\r\n                            opts.data.params = param;\r\n                            opts.data.query = query;\r\n\r\n                            if(object._send && object._send.data && typeof opts.onData === 'function'){\r\n                                opts.onData.call(opts, object._send.data);\r\n                                delete object._send;\r\n                            }\r\n\r\n                            if(_isRrender){\r\n                                if(opts.wrapper && !object._wrapper){\r\n                                    if(typeof opts.wrapper !== 'boolean'){\r\n                                        object._wrapper = object.container.children(opts.wrapper)\r\n                                    }\r\n                                    else{\r\n                                        object._wrapper = self._getWrapper(object.container)\r\n                                    }\r\n                                }\r\n                                else if(!self._wrapper){\r\n                                    self._wrapper = self._getWrapper(object.container)\r\n                                }\r\n                                if(object._isRrender || !object._wrapper){\r\n                                    component.destroy((object._wrapper||self._wrapper).off());\r\n                                }\r\n                            }\r\n\r\n                            var wrapper = opts.element = object._wrapper || self._wrapper;\r\n\r\n                            if(typeof opts.onChange === 'function'){\r\n                                opts.onChange.call(opts);\r\n                            }\r\n                                \r\n                            if(_isRrender){\r\n                                var tmpl = opts.template;\r\n                                if(tmpl){\r\n                                    if(typeof tmpl === 'string'){\r\n                                        wrapper.html(template.render(tmpl, opts.data));\r\n                                    }\r\n                                    else{\r\n                                        wrapper.html(template.render.call(tmpl, tmpl.main, opts.data));\r\n                                    }\r\n                                }\r\n                                if(typeof opts.onInit === 'function'){\r\n                                    opts.onInit.call(opts);\r\n                                }\r\n                                events.call(opts);\r\n                                component.init(wrapper);\r\n                                object.loaded = true;\r\n                            }\r\n\r\n                            wrapper.show().siblings('.nui-router-wrapper').hide();\r\n                            if(typeof opts.onAfter === 'function'){\r\n                                opts.onAfter.call(opts)\r\n                            }\r\n                            self._initialize = match = true;\r\n                            if(Nui.bsie7){\r\n                                self._setHistory(_hash);\r\n                            }\r\n                            return false\r\n                        }\r\n                    }\r\n                })\r\n\r\n                if(!self._initialize){\r\n                    Nui.each(self.__instances, function(v){\r\n                        if(!self._isEntry && v._options.entry === true){\r\n                            self._isEntry= true;\r\n                            if(v.target){\r\n                                v._render(v.target.eq(0));\r\n                            }\r\n                            else if(v.path){\r\n                                v._render(v.path);\r\n                            }\r\n                            self._initialize = true;\r\n                            return false\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n            self._oldhash = _hash;\r\n        },\r\n        _bindHashchange:function(){\r\n            var self = this;\r\n            if(Nui.bsie7){\r\n                var hashchange = function(ret){\r\n                    var hash = location.hash;\r\n                    if(self._oldhash !== hash){\r\n                        return !ret\r\n                    }\r\n                    return false\r\n                }\r\n                setInterval(function(){\r\n                    if(hashchange()){\r\n                        self._change()\r\n                    }\r\n                }, 100);\r\n                hashchange(true)\r\n            }\r\n            else{\r\n                Nui.win.on('hashchange', function(){\r\n                    self._change()\r\n                })\r\n            }\r\n        },\r\n        _$ready:null,\r\n        _$fn:null,\r\n        init:null,\r\n        start:function(){\r\n            if(!this._initialize){\r\n                this._change();\r\n            }\r\n        },\r\n        location:function(url, data, render){\r\n            var self = this;\r\n            if(url){\r\n                if(arguments.length <=2 && typeof data === 'boolean'){\r\n                    render = data;\r\n                    data = null;\r\n                }\r\n                var temp, _router;\r\n                url = this._replace(url);\r\n                Nui.each(this._paths, function(val, rule){\r\n                    if(rule === url || (url.indexOf(val.path) === 0 &&\r\n                                        (temp = url.replace(val.path+'/', '')) && \r\n                                        temp.split('/').length === val.params.length)){\r\n                        _router = self.__instances[val.id];\r\n                        return false\r\n                    }\r\n                })\r\n                if(_router){\r\n                    _router._send = {\r\n                        data:data\r\n                    }\r\n                    _router._isRrender = render;\r\n                    _router._render(url)\r\n                }\r\n            }\r\n            else{\r\n                self.start()\r\n            }\r\n        },\r\n        forward:function(index){\r\n            history.forward(index);\r\n            return false\r\n        },\r\n        back:function(index){\r\n            history.back(index);\r\n            return false\r\n        }\r\n    }\r\n\r\n    if(Nui.bsie7){\r\n        statics._history = [];\r\n        statics._setHistory = function(hash){\r\n            if(!this._isHistory){\r\n                Nui.each(this._history, function(val){\r\n                    val.active = false\r\n                });\r\n                this._history.push({\r\n                    hash:hash,\r\n                    active:true\r\n                })\r\n            }\r\n            this._isHistory = false;\r\n        },\r\n        Nui.each(['forward', 'back'], function(v){\r\n            var value = v==='forward' ? 1 : -1;\r\n            statics[v] = function(){\r\n                var self = this, len = self._history.length;\r\n                statics._isHistory = true;\r\n                Nui.each(self._history, function(val, i){\r\n                    var index = i + value;\r\n                    if(val.active){\r\n                        //历史记录在起始或者末尾时，调用原生的记录\r\n                        if(index === -1 || index === len){\r\n                            window.history[v]();\r\n                            return false\r\n                        }\r\n                        var _history = self._history[index];\r\n                        if(_history){\r\n                            location.hash = _history.hash;\r\n                            _history.active = true;\r\n                        }\r\n                        val.active = false;\r\n                        return false\r\n                    }\r\n                })\r\n                return false\r\n            }\r\n        })\r\n    }\r\n\r\n    return this.extend(component, {\r\n        _static:statics,\r\n        _options:{\r\n            path:'',\r\n            template:'',\r\n            container:null,\r\n            data:{},\r\n            entry:false,\r\n            wrapper:false,\r\n            level:2,\r\n            onBefore:null,\r\n            onChange:null,\r\n            onData:null,\r\n            onInit:null,\r\n            onAfter:null\r\n        },\r\n        _init:function(){\r\n            var self = this, router = self.constructor;\r\n            if(self._exec() && !router._bind){\r\n                router._bind = true;\r\n                router._bindHashchange();\r\n            }\r\n        },\r\n        _exec:function(){\r\n            var self = this, opts = self._options, router = self.constructor;\r\n            self.container = router._jquery(opts.container);\r\n            if(opts.path && self.container){\r\n                self.path = router._replace(opts.path);\r\n                var paths = self._getpath();\r\n                var len = paths.params.length;\r\n                if((!len && opts.level === 1) || opts.level !== 1){\r\n                    router._setpaths(paths.rule, paths)\r\n                }\r\n                if(len && opts.level > 0){\r\n                    var params = [], split = '/:', param, sub;\r\n                    while(param = paths.params.shift()){\r\n                        params.push(param);\r\n                        sub = params.join(split);\r\n                        router._setpaths(paths.rule+split+sub, $.extend({}, paths, {\r\n                            params:sub.split(split)\r\n                        }))\r\n                    }\r\n                }\r\n                if(self._getTarget()){\r\n                    self._event()\r\n                }\r\n                return self\r\n            }\r\n        },\r\n        _getpath:function(){\r\n            var self = this, path = self.path, opts = self._options, index = path.indexOf('/:');\r\n            var paths = {\r\n                id:self.__id,\r\n                params:[],\r\n                rule:path,\r\n                path:path\r\n            }\r\n            if(index !== -1){\r\n                paths.params = path.substr(index+2).split('/:');\r\n                self.path = paths.path = path.substr(0, index);\r\n                if(opts.level > 0){\r\n                    paths.rule = paths.path;\r\n                }\r\n            }\r\n            return paths\r\n        },\r\n        _render:function(url){\r\n            var self = this, opts = self._options, href = url instanceof jQuery ? url.attr('href') : url;\r\n            if(href){\r\n                var trigger = false;\r\n                var change = function(){\r\n                    trigger = true;\r\n                    location.hash = '#!'+self.constructor._replace(href)\r\n                }\r\n                if(typeof opts.onBefore === 'function' && opts.onBefore.call(opts, change) === false){\r\n                    return false\r\n                }\r\n                if(!trigger){\r\n                    change()\r\n                }\r\n            }\r\n        },\r\n        _event:function(){\r\n            var self = this, opts = self._options;\r\n            self._on('click', Nui.doc, self.target, function(e, elem){\r\n                self._render(elem);\r\n                e.preventDefault()\r\n            })\r\n            return self\r\n        },\r\n        _reset:function(){\r\n            var self = this, router = self.constructor;\r\n            self._off();\r\n            Nui.each(router._paths, function(val, i){\r\n                if(val.id === self.__id){\r\n                    delete router._paths[i];\r\n                }\r\n            })\r\n            return self\r\n        },\r\n        option:null,\r\n        reset:null\r\n    })\r\n})\nNui.define('./script/demo',['src/components/router'], function(router){\r\n\tvar renders = this.renders;\r\n\tvar require = this.require;\r\n\trouter({\r\n\t\ttarget:'#home',\r\n\t\tentry:true,\r\n\t\tpath:'/home/',\r\n\t\twrapper:'#aa',\r\n\t\tcontainer:'#main',\r\n\t\t//template:'<p>这是首页</p>',\r\n\t})\r\n\r\n\trouter({\r\n\t\ttarget:'#news, .news',\r\n\t\tentry:true,\r\n\t\tpath:'/news/:id/:title',\r\n\t\tcontainer:'#main',\r\n\t\tlevel:2,\r\n\t\ttemplate:{\r\n\t\t\tlist:renders(''+''\r\n\t\t\t\t+'<ul>'+''\r\n\t\t\t\t\t+'<%each list%>'+''\r\n\t\t\t\t\t+'<li><a href=\"<%$value.url%>/<%$value.title%>\" class=\"news\"><%$value.title%></a></li>'+''\r\n\t\t\t\t\t+'<%/each%>'+''\r\n\t\t\t\t+'</ul>'+''\r\n\t\t\t+''),\r\n\t\t\tdetail:'<div>'+\r\n\t\t\t\t\t\t'<h3><%params.title%></h3>'+\r\n\t\t\t\t\t\t'<p>这是<%params.title%>详情，id是<%params.id%>。</p>'+\r\n\t\t\t\t\t'</div>'\r\n\t\t},\r\n\t\tdata:{\r\n\t\t\tlist:[{\r\n\t\t\t\turl:'/news/1',\r\n\t\t\t\ttitle:'资讯1'\r\n\t\t\t},{\r\n\t\t\t\turl:'/news/2',\r\n\t\t\t\ttitle:'资讯2'\r\n\t\t\t}, {\r\n\t\t\t\turl:'/news/3',\r\n\t\t\t\ttitle:'资讯3'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tonChange:function(){\r\n\t\t\tvar tpl = this.template, params = this.data.params;\r\n\t\t\tif(params.id && params.title){\r\n\t\t\t\ttpl.main = tpl.detail;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\ttpl.main = tpl.list;\r\n\t\t\t}\r\n\t\t},\r\n\t\tonInit:function(){\r\n\t\t\t\r\n\t\t}\r\n\t})\r\n\r\n\trouter.start()\r\n})\n"]}