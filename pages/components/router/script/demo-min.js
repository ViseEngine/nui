Nui.define('src/components/router',['component','template','events'],function(t,e,r){var n={_paths:{},_init:function(){var t=this;Nui.doc.on('click','.nui-router-back',function(){return t.back()}).on('click','.nui-router-forward',function(){return t.forward()})},_setpaths:function(t,e){this._paths[t]||(this._paths[t]=e)},_replace:function(t){return t.replace(location.protocol+'//'+location.host,'').replace(/\s+/g,'').replace(/^\#\!?/,'').replace(/^([^\/])/,'/$1').replace(/\/$/,'')},_getWrapper:function(t){return $('<div class="nui-router-wrapper"></div>').appendTo(t)},_split:function(t){var e={url:t,params:{}},r=t.match(/\?[^\/\s]+/);if(r){var n=r[0];e.url=t.replace(n,''),n=n.replace('?','').split('&'),Nui.each(n,function(t,r){var n=t.split('=');e.params[n[0]]=n[1]})}return e},_change:function(){var n=this;if(!$.isEmptyObject(n._paths)){var a=location.hash,i=this._split(a),o=n._replace(i.url),s=i.params;Nui.each(n._paths,function(i){if(o===i.path||0===o.indexOf(i.path)){var c=o.replace(i.path,'').replace(/^\//,''),p=n.__instances[i.id],h=p.options,u={};if(c=c?c.split('/'):[],c.length===i.params.length){if(Nui.each(i.params,function(t,e){u[t]=c[e]}),Nui.each(s,function(t,e){u[t]=s[e]}),p._send&&p._send.data&&'function'==typeof h.onData&&(h.onData.call(h,p._send.data),delete p._send),h.data.path=i.path+'/',h.data.url=o+'/',h.data.params=u,h.data.query=s,!0===p._isRrender||!p._wrapper){h.wrapper&&!p._wrapper?p._wrapper=n._getWrapper(p.container):n._wrapper||(n._wrapper=n._getWrapper(p.container)),!p._isRrender&&p._wrapper||t.destroy((p._wrapper||n._wrapper).off());var l=h.element=p._wrapper||n._wrapper,_=h.template;_&&('string'==typeof _?l.html(e.render(_,h.data)):l.html(e.render.call(_,_.layout,h.data))),'function'==typeof h.onAfter&&h.onChange.call(h),r.call(h),t.init(l),delete p._isRrender}var l=p._wrapper||n._wrapper;return l.show().siblings('.nui-router-wrapper').hide(),'function'==typeof h.onAfter&&h.onAfter.call(h),n._initialize=match=!0,Nui.bsie7&&n._setHistory(a),!1}}}),n._initialize||Nui.each(n.__instances,function(t){if(!n._isEntry&&!0===t.options.entry)return n._isEntry=!0,t.target&&t._render(t.target.eq(0)),n._initialize=!0,!1})}n._oldhash=a},_bindHashchange:function(){var t=this;if(Nui.bsie7){var e=function(e){var r=location.hash;return t._oldhash!==r&&!e};setInterval(function(){e()&&t._change()},100),e(!0)}else Nui.win.on('hashchange',function(){t._change()})},_$ready:null,_$fn:null,start:function(){this._initialize||this._change()},location:function(t,e,r){var n=this;if(t){arguments.length<=2&&'boolean'==typeof e&&(r=e,e=null);var a,i;t=this._replace(t),Nui.each(this._paths,function(e,r){if(r===t||0===t.indexOf(e.path)&&(a=t.replace(e.path+'/',''))&&a.split('/').length===e.params.length)return i=n.__instances[e.id],!1}),i&&(i._send={data:e},i._isRrender=r,i._render(t))}else n.start()},forward:function(t){return history.forward(t),!1},back:function(t){return history.back(t),!1}};return Nui.bsie7&&(n._history=[],n._setHistory=function(t){this._isHistory||(Nui.each(this._history,function(t){t.active=!1}),this._history.push({hash:t,active:!0})),this._isHistory=!1},Nui.each(['forward','back'],function(t){var e='forward'===t?1:-1;n[t]=function(){var r=this,a=r._history.length;return n._isHistory=!0,Nui.each(r._history,function(n,i){var o=i+e;if(n.active){if(-1===o||o===a)return window.history[t](),!1;var s=r._history[o];return s&&(location.hash=s.hash,s.active=!0),n.active=!1,!1}}),!1}})),this.extend(t,{static:n,options:{path:'',template:'',container:null,data:{},entry:!1,wrapper:!1,level:1,onBefore:null,onChange:null,onAfter:null,onData:null},_init:function(){var t=this,e=t.constructor;t._exec()&&!e._bind&&(e._bind=!0,e._bindHashchange())},_exec:function(){var t=this,e=t.options,r=t.constructor;if(t.container=r._jquery(e.container),e.path&&t.container){t.path=r._replace(e.path);var n=t._getpath(),a=n.params.length;if((!a&&1===e.level||1!==e.level)&&r._setpaths(n.rule,n),a&&e.level>0)for(var i,o,s=[];i=n.params.shift();)s.push(i),o=s.join('/:'),r._setpaths(n.rule+'/:'+o,$.extend({},n,{params:o.split('/:')}));if(t._getTarget())return t._event()}},_getpath:function(){var t=this,e=t.path,r=t.options,n=e.indexOf('/:'),a={id:t.__id,params:[],rule:e,path:e};return-1!==n&&(a.params=e.substr(n+2).split('/:'),a.path=e.substr(0,n),r.level>0&&(a.rule=a.path)),a},_render:function(t){var e=this,r=e.options,n=t instanceof jQuery?t.attr('href'):t;if(n){var a=!1,i=function(){a=!0,location.hash='#!'+e.constructor._replace(n)};if('function'==typeof r.onBefore&&!1===r.onBefore.call(r,i))return!1;a||i()}},_event:function(){var t=this;t.options;return t._on('click',Nui.doc,t.target,function(e,r){return t._render(r),!1}),t},_reset:function(){var t=this,e=t.constructor;return t._off(),Nui.each(e._paths,function(r,n){r.id===t.__id&&delete e._paths[n]}),t}})}),Nui.define('./script/demo',['src/components/router'],function(t){t({target:'#home',entry:!0,path:'/home/',container:'#main',template:'<div>这是首页</div>'}),t({target:'#news',path:'/news/',container:'#main',template:'<div>这是资讯页</div>'}),t.start()});
//# sourceMappingURL=demo-min.js.map?v=e8a98da