Nui.define('src/components/layer/layer',['component','util','template'],function(e,t,i){var n={_maskzIndex:1e4,_zIndex:1e4,_init:function(){var e=this,t=null;Nui.win.on('resize',function(){clearTimeout(t),t=setTimeout(function(){Nui.each(e.__instances,function(e){var t=e._options;(t.position||!0===t.isCenter)&&e.resize()})})})},_$fn:null,_$ready:null,init:null},o={content:'',template:'',data:{},width:320,height:'auto',maxWidth:0,maxHeight:0,timer:0,edge:0,container:'body',title:'温馨提示',isMove:!1,isMask:!0,isInnerMove:!1,isClickMask:!1,isMoveMask:!1,isHide:!0,isCenter:!0,isFull:!1,isTop:!1,isTips:!1,isFixed:!0,scrollbar:!0,align:'center',bubble:{enable:!1,dir:'top'},iframe:{enable:!1,cache:!1,src:''},close:{enable:!0,text:'×'},confirm:{enable:!1,name:'normal',text:'确定',callback:function(){return!0}},cancel:{enable:!0,text:'取消'},position:null,under:null,button:null,onMove:null,onResize:null,onScroll:null,onBeforeDestroy:null,onTimer:null};return this.extend(e,{_static:n,_options:o,_template:{layout:'<div class="<% className %>" style="<% include \'style\' %>"><div class="layer-box"><%if close%><% var btn = close %><% include "button" %><%/if%><%if bubble%><span class="layer-bubble layer-bubble-<%bubble.dir||"top"%>"<%if bubble.style%> style="<%each bubble.style v n%><%n%>:<%v%>;<%/each%>"<%/if%>><b></b><i></i></span><%/if%><%if title%><div class="layer-head"><span class="layer-title"><%title%></span></div><%/if%><div class="layer-body"><div class="layer-main"><%content%></div></div><%if button && button.length%><div class="layer-foot" style="text-align:<%align%>"><div class="layer-inner"><%each button btn%><%include "button"%><%/each%></div></div><%/if%></div></div>',button:'<button class="ui-button<%if btn.name%><%each [].concat(btn.name) name%> ui-button-<%name%><%/each%><%/if%> layer-button-<%btn.id%>"<%if btn.style%> style="<%each btn.style v n%><%n%>:<%v%>;<%/each%>"<%/if%>><%btn.text || "按钮"%></button>',iframe:'<iframe<%each attr%> <%$index%>="<%$value%>"<%/each%>></iframe>',mask:'<div class="nui-layer-mask<%if skin%> nui-layer-mask-<%skin%><%/if%>" style="<%include \'style\'%>"><div class="layer-mask"></div></div>',movemask:'<div class="nui-layer-movemask<%if skin%> nui-layer-movemask-<%skin%><%/if%>" style="<%include \'style\'%>"></div>',style:'<%each style%><%$index%>:<%$value%>;<%/each%>'},data:{},_init:function(){this._zIndex=++this.constructor._zIndex,this._exec()},_exec:function(){var e=this,t=e._options,i=e.constructor;if(e._container=i._jquery(t.container),e._container.length){if(e._containerDOM=e._container.get(0),'BODY'!==e._containerDOM.tagName){e._window=e._container,e._isWindow=!1;var n=e._container.css('position');'absolute'!==n&&'relative'!==n&&e._container.css('position','relative')}else e._window=Nui.win,e._isWindow=!0;e._isFixed=t.isFixed&&!Nui.bsie6&&e._isWindow,e._create()}},_create:function(){var e=this,t=e._options,i=e._createButton(),n=!1;!0!==t.isTips&&(n='string'==typeof t.title);var o=e._tplData({content:e._getContent(),close:i.close,button:i.button,title:n?t.title||'温馨提示':null,bubble:!0===t.bubble.enable?t.bubble:null,align:t.align||'center',style:{'z-index':e._zIndex,'position':'absolute','display':'block'}});e._isFixed&&(o.style.position='fixed'),e._setTop(),e.element=e._bindComponentName($(e._tpl2html('layout',o)).appendTo(e._container)),e._box=e.element.children('.layer-box'),e.head=e._box.children('.layer-head'),e._body=e._box.children('.layer-body'),e.main=e._body.children('.layer-main'),e.foot=e._box.children('.layer-foot'),!0!==t.isTips&&(!0===t.iframe.enable&&(e._iframe=e.main.children('iframe'),e._iframeOnload()),!0===t.isMove&&n&&e._bindMove(),!0===t.isTop&&e._bindTop()),e._button.length&&e._buttonEvent(),!0===t.isFixed&&!0==!e._isFixed&&e._bindScroll(),e._event(),e._show()},_getContent:function(){var e=this,t=e._options,n='',o=t.template;return!0!==t.isTips&&!0===t.iframe.enable?n=e._createIframe():o?'string'==typeof o?n=i.render(o,t.data):Nui.type(t.template,'Object')&&(n=i.render.call(o,o.main,t.data)):'string'==typeof t.content?n=t.content:t.content instanceof jQuery&&(n=t.content.prop('outerHTML')),n},_createIframe:function(){var e=this,i=e._options,n='layer-iframe'+e.__id,o=i.iframe.src;return!1===i.iframe.cache&&(o=t.setParam('_',(new Date).getTime(),o)),e._tpl2html('iframe',{attr:{frameborder:'0',name:n,id:n,src:o,scroll:'hidden',style:'width:100%;'}})},_iframeOnload:function(){var e=this;e._iframe.load(function(){e._iframeDocument=e._iframe.contents(),e._resize()})},_createButton:function(){var e=this,t=e._options,i={},n={},o={};return e._button=[],!0!==t.isTips&&(Nui.each(['confirm','cancel'],function(e){var n=t[e];n&&!0===n.enable&&(i[e]={id:e,name:n.name,style:n.style,text:n.text,callback:n.callback})}),t.button&&t.button.length&&Nui.each(t.button,function(t){var n=t.id;o[n]||(o[n]=!0,i[n]&&(t.text||('cancel'===n?t.text='取消':'confirm'===n&&(t.text='确定')),delete i[n]),e._button['close'===n?'unshift':'push'](t))}),Nui.each(i,function(t){e._button.push(t)})),!o.close&&t.close&&!0===t.close.enable&&e._button.unshift({id:'close',name:t.close.name,style:t.close.style,text:t.close.text,callback:t.close.callback}),e._button[0]&&'close'===e._button[0].id?(n.close=e._button[0],n.button=e._button.slice(1)):n.button=e._button,n},_buttonEvent:function(){var e=this,t=e._options;Nui.each(e._button,function(i){e._on('click',e.element,'.layer-button-'+i.id,function(n,o){if(!o.hasClass('nui-button-disabled')){var a=i.id,s=i.callback,l='function'==typeof s?s.call(t,e,n,o):null;('confirm'===a&&!0===l||'confirm'!==a&&!1!==l)&&e.destroy()}})})},_bindTop:function(){var e=this;e._on('click',e.element,function(){e._setzIndex()})},_bindMove:function(){var e,t,i,n,o=this,a=o._options,s=o.element,l=o.constructor,r=s,c=!1;o._on('mousedown',o.head,function(i,n){c=!0,o._setzIndex(),!0===a.isMoveMask&&(r=o._moveMask=$(o._tpl2html('movemask',{skin:a.skin,style:{'z-index':o._zIndex+1,'cursor':'move','position':o._isFixed?'fixed':'absolute'}})).appendTo(o._container),r.css({width:o.data.outerWidth-l._getSize(r,'lr','all'),height:o.data.outerHeight-l._getSize(r,'tb','all'),top:o.data.top,left:o.data.left})),n.css('cursor','move'),e=i.pageX-o.data.left,t=i.pageY-o.data.top,i.stopPropagation()}),o._on('mousemove',Nui.doc,function(s){var l=o._container.outerWidth(),d=o._container.outerHeight();if(c)return i=s.pageX-e,n=s.pageY-t,i<0&&(i=0),n<0&&(n=0),!0===a.isInnerMove&&(i+o.data.outerWidth>l&&(i=l-o.data.outerWidth),n+o.data.outerHeight>d&&(n=d-o.data.outerHeight)),o.data.top=n,o.data.left=i,r.css({top:n,left:i}),!c}),o._on('mouseup',Nui.doc,function(e){c&&(c=!1,o.head.css('cursor','default'),!0===a.isMoveMask&&(s.css(o.data),o._moveMask.remove(),o._moveMask=null),o._callback('Move'),o.data.offsetTop=o.data.top-o._window.scrollTop(),o.data.offsetLeft=o.data.left-o._window.scrollLeft())})},_bindScroll:function(){var e=this;e._options;e._on('scroll',e._window,function(t,i){var n=e.data.offsetTop+e._window.scrollTop(),o=e.data.offsetLeft+e._window.scrollLeft();e.data.top=n,e.data.left=o,e.element.css(e.data),e._callback('Scroll',[t,i,{top:n,left:o}])})},_setzIndex:function(){var e=this,t=e.constructor;e._isTop&&e.element&&(e._isTop=!1,e._zIndex=++t._zIndex,e.element.css('zIndex',e._zIndex),e._setTop())},_setLower:function(e){var t=this,i=t.constructor,n=t._options,o=[];n.under&&(o=o.concat(n.under),o.length&&Nui.each(o,function(t,n){t&&t.element&&t.element.css('z-index',e?t._zIndex:i._maskzIndex-1)}))},_setTop:function(){var e=this,t=e.constructor;Nui.each(t.__instances,function(t){t&&t!==e&&!0===t._options.isTop&&(t._isTop=!0)})},_position:function(){var e,t=this,i=t.data,n=t._options.position,o={top:n.top,left:n.left,right:n.right,bottom:n.bottom};return void 0!==o.top&&void 0!==o.bottom&&delete o.bottom,void 0!==o.left&&void 0!==o.right&&delete o.right,Nui.each(o,function(t,n){if(void 0===t)return delete o[n],!0;e=t,'string'==typeof t&&(t?'top'===n||'bottom'===n?'self'===t?e=i.outerHeight:/[\+\-\*\/]/.test(t)&&(e=new Function('var self = '+i.outerHeight+'; return '+t)()):'self'===t?e=i.outerWidth:/[\+\-\*\/]/.test(t)&&(e=new Function('var self = '+i.outerWidth+'; return '+t)()):e=0),o[n]='auto'===e?'auto':parseFloat(e)+'px'}),o},_resize:function(e){var t=this,i=(t.constructor,t._options),n=t.element,o=t._window.outerWidth(),a=t._window.outerHeight(),s=0,l=0;if(t._isFixed||(l=t._window.scrollLeft(),s=t._window.scrollTop()),t._setSize(),i.position){var r=n.css(t._position()).position();Nui.bsie6&&(l=0,s=0),t.data.left=r.left+l,t.data.top=r.top+s}else if('init'===e||!0===i.isCenter){var c=(o-t.data.outerWidth)/2+l,d=(a-t.data.outerHeight)/2+s,u=i.edge>0?i.edge:0;t.data.left=c>0?c:u,t.data.top=d>0?d:u}t.data.offsetTop=t.data.top-t._window.scrollTop(),t.data.offsetLeft=t.data.left-t._window.scrollLeft(),n.css(t.data)},_setSize:function(){var e=this,t=e.constructor,i=e._options,n=e.element,o=i.edge>0?2*i.edge:0,a=e._window.outerWidth()-o,s=e._window.outerHeight()-o,l=i.scrollbar;e._body.css({height:'auto',overflow:'visible'}),n.css({top:'auto',left:'auto',width:'auto',height:'auto'});var r=t._getSize(e._box,'tb','all')+e.head.outerHeight()+t._getSize(e.head,'tb','margin')+t._getSize(e._body,'tb','all')+e.foot.outerHeight()+t._getSize(e.foot,'tb','margin'),c=n.outerWidth();!0!==i.isFull?(i.width>0?c=i.width:('100%'===i.width||!0===i.scrollbar&&c>a)&&(c=a),i.maxWidth>0&&c>=i.maxWidth&&(l=!0,c=i.maxWidth)):c=a;var d='nowrap';(i.width>0||c==i.maxWidth||c==a)&&(d='normal'),e.data.width=c-t._getSize(n,'lr','all'),e.main.css('white-space',d),n.width(e.data.width);var u=n.outerHeight();e._iframeDocument&&(e._iframeDocument[0].layer=e,u=r+e._iframeDocument.find('body').outerHeight()),!0!==i.isFull?(i.height>0?u=i.height:('100%'===i.height||(!0===i.scrollbar||e._iframeDocument)&&u>s)&&(u=s),i.maxHeight>0&&u>=i.maxHeight&&(l=!0,u=i.maxHeight)):u=s,e.data.outerWidth=c,e.data.outerHeight=u,e.data.height=u-t._getSize(n,'tb','all'),n.height(e.data.height);var f=e.data.height-r;e.main.outerHeight()>f&&!e._iframe&&!0===l&&e._body.css('overflow','auto'),e._iframe&&e._iframe.height(f),e._body.height(e.data.contentHeight=f)},_showMask:function(){var e=this,t=e.constructor,i=e._options;e._containerDOM.__layermask__||(e._containerDOM.__layermask__=$(e._tpl2html('mask',{skin:i.skin,style:{'z-index':t._maskzIndex,'position':e._isFixed?'fixed':'absolute','top':'0px','left':'0px','width':'100%','height':e._isFixed?'100%':e._container.outerHeight()+'px'}})).appendTo(e._container)),!0===i.isClickMask&&e._on('click',e._containerDOM.__layermask__,function(){e.hide()})},_show:function(){var t=this,i=t._options;return e.init(t.main),t._resize('init'),t._setLower(),!0===i.isMask&&t._showMask(),i.timer>0&&(t._time=i.timer,t._timer()),t._callback('Init'),t},_timer:function(){var e=this;e._options;e._time>0?(e._callback('Timer',[e._time]),e._timerid=setTimeout(function(){e._time-=1e3,e._timer()},e._time>1e3?1e3:e._time)):e.hide()},_reset:function(){var t=this,i=t.constructor,n=!0;e.exports._reset.call(this),e('destroy',t.main),Nui.each(i.__instances,function(e){if(e&&!0===e._options.isMask&&e!==t&&e._containerDOM===t._containerDOM)return n=!1}),n&&t._containerDOM.__layermask__&&(t._containerDOM.__layermask__.remove(),t._containerDOM.__layermask__=null),t._options.timer>0&&(t.timer=0,clearTimeout(t._timerid))},resize:function(){var e=this;e._options,e.element;return e._resize(),e._callback('Resize'),e},hide:function(){!0===this._options.isHide&&this.destroy()},destroy:function(){var e=this,t=e.constructor;e._options;!1!==e._callback('BeforeDestroy')&&(e._delete(),e._reset(),e._setLower(!0),e._isdestroy||(t._zIndex--,e._isdestroy=!0),e._callback('Destroy'))}})}),Nui.define('src/components/layer/layerExt',['src/components/layer/layer','util'],function(layer,util){var module=this;return layer.alert=function(e,t,i,n){var o;return'object'==typeof e&&(o=e,e=o.content,delete o.content),layer($.extend({content:'<div style="padding:10px; line-height:20px;">'+(e||'')+'</div>',title:t,width:i,height:n,cancel:{text:'关闭'}},o||{}))},layer.confirm=function(e,t,i,n,o){var a;return'object'==typeof e&&(a=e,e=a.content,delete a.content),layer($.extend(!0,{content:'<div style="padding:10px; line-height:20px;">'+(e||'')+'</div>',title:i,width:n,height:o,align:'right',confirm:{callback:t||function(){return!0}}},a||{},{confirm:{enable:!0}}))},layer.iframe=function(e,t,i,n){return layer({iframe:{enable:!0,src:e},title:t,width:i,height:n,cancel:{text:'关闭'}})},layer.tips=function(e,t,i,n,o){var a;return'object'==typeof e&&(a=e,e=a.content,delete a.content),layer($.extend(!0,{content:e,id:'tips',width:n||'auto',height:o||'auto',position:i,bubble:{enable:!0,dir:t||'top'}},a||{},{isTips:!0,isMask:!1,isClose:!1,close:{enable:!1}}))},layer.loading=function(e,t,i){var n;return'object'==typeof e&&(n=e,e=n.content,delete n.content),Nui.type(e,'Number')&&(i=t,t=e,e=''),layer($.extend({content:'<div>'+(e||'正在加载数据...')+'</div>',width:t||'auto',height:i||'auto'},n||{},{id:'loading',isTips:!0,close:{enable:!1}}))},layer.message=function(e,t){var i,n='#f00';return'object'==typeof e&&(i=e,t=i.content,delete i.content,e='success'),'success'!==e&&'error'!==e&&(t=e,e='success'),'success'!==e||t?'error'!==e||t||(t='操作失败'):t='操作成功','success'===e&&(n='#39B54A'),layer($.extend({content:'<div style="padding:10px; color:'+n+';">'+t+'</div>',id:'message',width:'auto',height:'auto',isTips:!0,timer:1500,close:{enable:!0}},i||{},{isMask:!1}))},layer.form=function(options){var onInit=options.onInit;delete options.onInit;var valid=options.valid,btns=$.extend([],options.button||[{id:'cancel',text:'关闭'},{id:'confirm',name:'normal',text:'保存'}]);Nui.each(btns,function(e,t){if('confirm'===e.id&&!e.callback)return btns[t].callback=function(e,t){e.main.find('form').submit()},!1}),delete options.button;var formLayer=layer($.extend(!0,{button:btns},{scrollbar:!1,id:'form',onInit:function(self){var main=self.main,elems=main.find('[name!=""][data-rule]'),form=main.find('form'),rules={},messages={},setting=form.data('setting');elems.each(function(){var elem=$(this),name=elem.attr('name'),data=elem.data(),rule=eval('('+data.rule+')');if(rules[name]=rule,void 0!==data.message){var message=eval('('+data.message+')');$.each(message,function(e,t){'function'==typeof self._options.messageFilter&&(message[e]=self._options.messageFilter.call(self._options,name,t)||'')}),messages[name]=message}});var opts={rules:rules,messages:messages,errorClass:'s-err',onkeyup:!1,focusInvalid:!1,onfocusout:!1,focusCleanup:!0,ignore:'',success:function(e,t){e.remove(),$(t).addClass('s-succ')},errorPlacement:function(e,t){t.removeClass('s-succ'),e.text()&&t.closest(self._options.itemWrap||'.ui-item').find(self._options.errorWrap||'.ui-err').html(e)},submitHandler:function(){var e={};if(e='function'==typeof self._options.getData?self._options.getData.call(self._options,self,form):util.getData(form).result,'function'==typeof self._options.onBeforeSubmit&&!1===(e=self._options.onBeforeSubmit.call(self._options,self,e)))return!1;var t=layer.loading({content:self._options.loading||'正在保存数据...',under:self});$.ajax($.extend({url:form.attr('action'),dataType:'json',type:form.attr('method')||'POST',data:e,success:function(e,i){t.hide(),'function'==typeof self._options.onSuccess&&self._options.onSuccess.call(self._options,self,e,i)},error:function(e){t.hide(),'function'==typeof self._options.onError&&self._options.onError.call(self._options,self,e)}},self._options.ajax||{}),null)}};self.validator=form.validate($.extend(!0,opts,setting||{},valid||{})),'function'==typeof onInit&&onInit.call(self._options,self)}},options||{}));return formLayer},layer}),Nui.define('./script/events/page',['template','events','src/components/layer/layerExt'],function(e,t,i){t({elem:$('#data'),data:['蔬菜','水果','苹果'],template:this.renders('<%each $list%><li class="e-mt5"><label><input type="checkbox" value="<%$index%>"><span><%$value%></span></label></li><%/each%>'),events:{'click .j-add':'add render','click .j-del':'checks del remove render','click .j-update':'checks update'},checks:function(){var e=[];this.elem.find(':checked');return!!this.elem.find(':checked').length&&(this.elem.find(':checked').each(function(){e.push($(this).val())}),e)},render:function(){this.elem.html(e.render(this.template,this.data))},add:function(e,t,i){this.data.push('自定义')},remove:function(){var e=[];Nui.each(this.data,function(t){void 0!==t&&e.push(t)}),this.data=e},del:function(e,t,i){var n=this;Nui.each(i,function(e){delete n.data[e]})},update:function(e,t,n){var o=this;i.confirm('<input type="text" style="border:1px solid #ccc; width:180px; height:24px;" />',function(e,t){var i=Nui.trim(t.main.find('input').val());if(i)return Nui.each(n,function(e){o.data[e]=i}),o.render(),!0},'',210)}}).render()});
//# sourceMappingURL=page-min.js.map?v=028bd89