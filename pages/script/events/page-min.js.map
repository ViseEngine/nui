{"version":3,"sources":["page-debug.js"],"names":["Nui","define","layer","util","module","this","alert","content","title","width","height","opts","$","extend","cancel","text","confirm","callback","align","enable","iframe","src","tips","dir","position","id","bubble","isTips","isMask","isClose","close","loading","type","message","color","timer","form","options","onInit","valid","btns","button","name","each","val","i","self","e","main","find","submit","formLayer","scrollbar","elems","rules","messages","setting","data","elem","attr","rule","eval","key","msg","_options","messageFilter","call","errorClass","onkeyup","focusInvalid","onfocusout","focusCleanup","ignore","success","error","element","remove","addClass","errorPlacement","removeClass","closest","itemWrap","errorWrap","html","submitHandler","param","getData","result","onBeforeSubmit","under","ajax","url","dataType","res","xhr","hide","onSuccess","onError","validator","validate","template","events","renders","click .j-add","click .j-del","click .j-update","checks","arr","length","push","render","add","v","del","that","update","trim"],"mappings":"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","file":"page-min.js.map?v=bf64eaf","sourcesContent":["\n/**\r\n * @author Aniu[2016-11-10 22:39]\r\n * @update Aniu[2016-11-10 22:39]\r\n * @version 1.0.1\r\n * @description layer扩展\r\n */\r\n\r\nNui.define('src/components/layer/layerExt',['src/components/layer/layer', 'util'], function(layer, util){\r\n    var module = this;\r\n\r\n    layer.alert = function(content, title, width, height){\r\n        var opts;\r\n        if(typeof content === 'object'){\r\n            opts = content;\r\n            content = opts.content;\r\n            delete opts.content;\r\n        }\r\n        return layer($.extend({\r\n            content:'<div style=\"padding:10px; line-height:20px;\">'+(content||'')+'</div>',\r\n            title:title,\r\n            width:width,\r\n            height:height,\r\n            cancel:{\r\n                text:'关闭'\r\n            }\r\n        }, opts||{}))\r\n    }\r\n\r\n    layer.confirm = function(content, callback, title, width, height){\r\n        var opts;\r\n        if(typeof content === 'object'){\r\n            opts = content;\r\n            content = opts.content;\r\n            delete opts.content;\r\n        }\r\n        return layer($.extend(true, {\r\n            content:'<div style=\"padding:10px; line-height:20px;\">'+(content||'')+'</div>',\r\n            title:title,\r\n            width:width,\r\n            height:height,\r\n            align:'right',\r\n            confirm:{\r\n                callback:callback||function(){\r\n                    return true\r\n                }\r\n            }\r\n        }, opts||{}, {\r\n            confirm:{\r\n                enable:true\r\n            }\r\n        }))\r\n    }\r\n\r\n    layer.iframe = function(src, title, width, height){\r\n        return layer({\r\n            iframe:{\r\n                enable:true,\r\n                src:src\r\n            },\r\n            title:title,\r\n            width:width,\r\n            height:height,\r\n            cancel:{\r\n                text:'关闭'\r\n            }\r\n        })\r\n    }\r\n\r\n    layer.tips = function(content, dir, position, width, height){\r\n        var opts;\r\n        if(typeof content === 'object'){\r\n            opts = content;\r\n            content = opts.content;\r\n            delete opts.content;\r\n        }\r\n        return layer($.extend(true, {\r\n            content:content,\r\n            id:'tips',\r\n            width:width||'auto',\r\n            height:height||'auto',\r\n            position:position,\r\n            bubble:{\r\n                enable:true,\r\n                dir:dir||'top'\r\n            }\r\n        }, opts||{}, {\r\n            isTips:true,\r\n            isMask:false,\r\n            isClose:false,\r\n            close:{\r\n                enable:false\r\n            }\r\n        }))\r\n    }\r\n\r\n    layer.loading = function(content, width, height){\r\n        var opts;\r\n        if(typeof content === 'object'){\r\n            opts = content;\r\n            content = opts.content;\r\n            delete opts.content;\r\n        }\r\n        if(Nui.type(content, 'Number')){\r\n            height = width;\r\n            width = content;\r\n            content = '';\r\n        }\r\n        return layer($.extend({\r\n            content:'<div>'+(content||'正在加载数据...')+'</div>',\r\n            width:width||'auto',\r\n            height:height||'auto',\r\n        }, opts || {}, {\r\n            id:'loading',\r\n            isTips:true,\r\n            close:{\r\n                enable:false\r\n            }\r\n        }))\r\n    }\r\n\r\n    layer.message = function(type, content){\r\n        var opts, color = '#f00';\r\n        if(typeof type === 'object'){\r\n            opts = type;\r\n            content = opts.content;\r\n            delete opts.content;\r\n            type = 'success';\r\n        }\r\n\r\n        if(type !== 'success' && type !== 'error'){\r\n            content = type;\r\n            type = 'success';\r\n        }\r\n\r\n        if(type === 'success' && !content){\r\n            content = '操作成功'\r\n        }\r\n        else if(type === 'error' && !content){\r\n            content = '操作失败'\r\n        }\r\n\r\n        if(type === 'success'){\r\n            color = '#39B54A';\r\n        }\r\n\r\n        return layer($.extend({\r\n            content:'<div style=\"padding:10px; color:'+ color +';\">'+content+'</div>',\r\n            id:'message',\r\n            width:'auto',\r\n            height:'auto',\r\n            isTips:true,\r\n            timer:1500,\r\n            close:{\r\n                enable:true\r\n            }\r\n        }, opts || {}, {\r\n            isMask:false\r\n        }))\r\n    }\r\n\r\n    layer.form = function(options){\r\n        var onInit = options.onInit;\r\n        delete options.onInit;\r\n        var valid = options.valid;\r\n        var btns = $.extend([], options.button || [{\r\n            id:'cancel',\r\n            text:'关闭'\r\n        }, { \r\n            id:'confirm',\r\n            name:'normal',\r\n            text:'保存'\r\n        }])\r\n\r\n        Nui.each(btns, function(val, i){\r\n            if(val.id === 'confirm' && !val.callback){\r\n                btns[i].callback = function(self, e){\r\n                    self.main.find('form').submit()\r\n                }\r\n                return false\r\n            }\r\n        })\r\n\r\n        delete options.button;\r\n        var formLayer = layer($.extend(true, {button:btns}, {\r\n            scrollbar:false,\r\n            id:'form',\r\n            onInit:function(self){\r\n                var main = self.main;\r\n                var elems = main.find('[name!=\"\"][data-rule]');\r\n                var form = main.find('form');\r\n                var rules = {};\r\n                var messages = {};\r\n                var setting = form.data('setting');\r\n                elems.each(function(){\r\n                    var elem = $(this);\r\n                    var name = elem.attr('name');\r\n                    var data = elem.data();\r\n                    var rule = eval('('+ data.rule +')');\r\n                    rules[name] = rule;\r\n                    if(typeof data.message !== 'undefined'){\r\n                        var message = eval('('+ data.message +')');\r\n                        $.each(message, function(key, msg){\r\n                            if(typeof self._options.messageFilter === 'function'){\r\n                                message[key] = self._options.messageFilter.call(self._options, name, msg)||''\r\n                            }\r\n                        })\r\n                        messages[name] = message;\r\n                    } \r\n                });\r\n                var opts = {\r\n                    rules:rules,\r\n                    messages:messages,\r\n                    errorClass:'s-err',\r\n\t\t\t\t\tonkeyup:false,\r\n\t\t\t\t\tfocusInvalid:false,\r\n                    onfocusout:false,\r\n\t\t\t\t\tfocusCleanup:true,\r\n                    ignore:'',\r\n                    success:function(error, element) {\r\n\t\t\t\t\t\terror.remove();\r\n\t\t\t\t\t\t$(element).addClass('s-succ');\r\n\t\t\t\t\t},\r\n\t\t\t\t\terrorPlacement:function(error, element) {\r\n\t\t\t\t\t\telement.removeClass('s-succ');\r\n\t\t\t\t\t\tif(error.text()){\r\n\t\t\t\t\t\t\telement.closest(self._options.itemWrap||'.ui-item').find(self._options.errorWrap||'.ui-err').html(error);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n                    submitHandler:function(){\r\n                        var param = {};\r\n                        if(typeof self._options.getData === 'function'){\r\n                        \tparam = self._options.getData.call(self._options, self, form)\r\n                        }\r\n                        else{\r\n                            param = util.getData(form).result;\r\n                        }\r\n\r\n                        if(typeof self._options.onBeforeSubmit === 'function'){\r\n                        \tparam = self._options.onBeforeSubmit.call(self._options, self, param);\r\n                            if(param === false){\r\n                                return false\r\n                            }\r\n                        }\r\n\r\n                        var loading = layer.loading({\r\n                            content:self._options.loading||'正在保存数据...',\r\n                            under:self\r\n                        });\r\n                        \r\n                        $.ajax($.extend({\r\n                            url:form.attr('action'),\r\n                            dataType:'json',\r\n                            type:form.attr('method')||'POST',\r\n                            data:param,\r\n                            success:function(res, xhr){\r\n                                loading.hide();\r\n                                if(typeof self._options.onSuccess === 'function'){\r\n                                    self._options.onSuccess.call(self._options, self, res, xhr)\r\n                                }\r\n                            },\r\n                            error:function(xhr){\r\n                                loading.hide();\r\n                                if(typeof self._options.onError === 'function'){\r\n                                    self._options.onError.call(self._options, self, xhr)\r\n                                }\r\n                            }\r\n                        }, self._options.ajax||{}), null)\r\n                    }\r\n                }\r\n                self.validator = form.validate($.extend(true, opts, setting||{}, valid||{}));\r\n                typeof onInit === 'function' && onInit.call(self._options, self)\r\n            }\r\n        }, options||{}))\r\n        return formLayer\r\n    }\r\n\r\n    return layer\r\n})\nNui.define('./script/events/page',['template', 'events', 'src/components/layer/layerExt'], function(template, events, layer){\r\n\r\n    var evt = events({\r\n        elem:$('#data'),\r\n        data:['蔬菜', '水果', '苹果'],\r\n        template:this.renders(''+''\r\n            +'<%each $list%>'+''\r\n            +'<li class=\"e-mt5\">'+''\r\n                +'<label>'+''\r\n                    +'<input type=\"checkbox\" value=\"<%$index%>\">'+''\r\n                    +'<span><%$value%></span>'+''\r\n                +'</label>'+''\r\n            +'</li>'+''\r\n            +'<%/each%>'+''\r\n        +''),\r\n        events:{\r\n            'click .j-add':'add render',\r\n            'click .j-del':'checks del remove render',\r\n            'click .j-update':'checks update'\r\n        },\r\n        checks:function(){\r\n            var arr = [], elems = this.elem.find(':checked');\r\n            if(!this.elem.find(':checked').length){\r\n                return false\r\n            }\r\n            this.elem.find(':checked').each(function(){\r\n                arr.push($(this).val())\r\n            })\r\n            return arr\r\n        },\r\n        render:function(){\r\n            this.elem.html(template.render(this.template, this.data))\r\n        },\r\n        add:function(e, elem, data){\r\n            this.data.push('自定义');\r\n        },\r\n        remove:function(){\r\n            var data = [];\r\n            Nui.each(this.data, function(v){\r\n                if(typeof v !== 'undefined'){\r\n                    data.push(v)\r\n                }\r\n            });\r\n            this.data = data;\r\n        },\r\n        del:function(e, elem, data){\r\n            var that = this;\r\n            Nui.each(data, function(v){\r\n                delete that.data[v]\r\n            });\r\n        },\r\n        update:function(e, elem, data){\r\n            var that = this;\r\n            layer.confirm('<input type=\"text\" style=\"border:1px solid #ccc; width:180px; height:24px;\" />', function(e, self){\r\n                var val = Nui.trim(self.main.find('input').val());\r\n                if(val){\r\n                    Nui.each(data, function(v){\r\n                        that.data[v] = val;\r\n                    })\r\n                    that.render();\r\n                    return true\r\n                }\r\n            }, '', 210)\r\n        }\r\n    })\r\n\r\n    evt.render()\r\n})\n"]}